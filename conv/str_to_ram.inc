;-----------------------------------------------------------------------------------------------------------------------
;Файл распространяется под лицензией GPL-3.0-or-later, https://www.gnu.org/licenses/gpl-3.0.txt
;-----------------------------------------------------------------------------------------------------------------------
;02.01.2021  w5277c@gmail.com			Начало
;-----------------------------------------------------------------------------------------------------------------------
.ifdef DEF_STR_TO_RAM
.else
.set DEF_STR_TO_RAM = 1

;--------------------------------------------------------
STR_TO_RAM:
;--------------------------------------------------------
;Копироавние текстового блока в RAM
;IN: Y-src адрес(15-ый бит false - RAM, true - ROM),
;X-dst-адрес. (0x00 - конец строки)
;OUT: X - адрес для следующего символа строки
;--------------------------------------------------------
	PUSH_Z
	MOV ZH,YH
	MOV ZL,YL
	;Умножаем на 2 адрес рабоыт с ROM
	SBRS ZH,0x07
	RJMP PC+0x04
	LSL ZL
	ROL ZH
	ORI ZH,0x80

_STR_TO_RAM__BYTES_LOOP:
	;Считываем байт
	SBRC ZH,0x07
	RJMP PC+0x03
	LD TEMP,Z+
	RJMP PC+04
	ANDI ZH,0b01111111
	LPM TEMP,Z+
	ORI ZH,0b10000000
	CPI TEMP,0x00
	BREQ _STR_TO_RAM__END
	ST X+,TEMP
	RJMP _STR_TO_RAM__BYTES_LOOP

_STR_TO_RAM__END:
	POP_Z
	RET
.endif
