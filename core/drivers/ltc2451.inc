;-----------------------------------------------------------------------------------------------------------------------
;Файл распространяется под лицензией GPL-3.0-or-later, https://www.gnu.org/licenses/gpl-3.0.txt
;-----------------------------------------------------------------------------------------------------------------------
;20.09.2021	w5277c@gmail.com			Начало
;-----------------------------------------------------------------------------------------------------------------------
;16 бит АЦП с шиной I2C
;-----------------------------------------------------------------------------------------------------------------------

.include	"./core/ram/ram_offset.inc"
.include	"./core/ram/ram_realloc.inc"
.include	"./math/mul16x8.inc"
.include	"./math/div16x8.inc"

;---CONSTANTS--------------------------------------------
	.EQU	_DRV_LTC2451_I2C_DRV					= 0x00			;1Б-ид драйвера шины I2C
	;---
	.EQU	_DRV_LTC2451_RAM_SIZE				= 0x01

;--------------------------------------------------------
DRV_LTC2451_INIT:
;--------------------------------------------------------
;Инициализация
;IN: ACCUM-ид драйвера I2C
;--------------------------------------------------------
	PUSH ACCUM
	LDI ACCUM,_DRV_LTC2451_RAM_SIZE
	MCALL C5_RAM_REALLOC
	POP ACCUM
	STD Y+_DRV_LTC2451_I2C_DRV,ACCUM

	MCALL C5_READY
;--------------------------------------------------------
;Основной код, работа с датчиком
;OUT: TEMP-результат, TEMP_H,TEMP_L-значение измерения
;--------------------------------------------------------
	PUSH ACCUM
	PUSH TEMP
	PUSH TEMP_H
	PUSH TEMP_L
	PUSH TEMP_EL
	PUSH_Y
	PUSH_Z

	MCALL C5_RAM_OFFSET

	;TODO

	POP_Z
	POP_Y
	POP TEMP_EL
	POP TEMP_L
	POP TEMP_H
	POP TEMP
	POP ACCUM
	RET
